
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Underlying &#8212; PyPricing 2023 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/sphinx-toolbox.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_toolbox_installation.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/sphinx_toolbox_installation.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">PyPricing 2023 documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../Structured/structured_main.html">
                        Structured
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../Interest_Rate_Products/irproducts_main.html">
                        Interest Rate Products
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../Interest_Rate_Models/irmodels_main.html">
                        Interest Rate Models
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="underlyings_main.html">
                        Underlyings
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../MonteCarlo_engines/mc_main.html">
                        MonteCarlo engines
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../Discount_curves/discount_curves_main.html">
                        Discount curves
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../Fixed_Income/fixedincome_main.html">
                        Fixed income
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../Rate_Curves/ratecurves_main.html">
                        Rate Curves
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../Risk/risk_main.html">
                        Risk
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../Others/others_main.html">
                        Others
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../changelog.html">
                        Changelog
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../Structured/structured_main.html">
                        Structured
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../Interest_Rate_Products/irproducts_main.html">
                        Interest Rate Products
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../Interest_Rate_Models/irmodels_main.html">
                        Interest Rate Models
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="underlyings_main.html">
                        Underlyings
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../MonteCarlo_engines/mc_main.html">
                        MonteCarlo engines
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../Discount_curves/discount_curves_main.html">
                        Discount curves
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../Fixed_Income/fixedincome_main.html">
                        Fixed income
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../Rate_Curves/ratecurves_main.html">
                        Rate Curves
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../Risk/risk_main.html">
                        Risk
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../Others/others_main.html">
                        Others
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../changelog.html">
                        Changelog
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<h3><a href="../index.html">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Structured/structured_main.html">Structured</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Interest_Rate_Products/irproducts_main.html">Interest Rate Products</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Interest_Rate_Models/irmodels_main.html">Interest Rate Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="underlyings_main.html">Underlyings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MonteCarlo_engines/mc_main.html">MonteCarlo engines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Discount_curves/discount_curves_main.html">Discount curves</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Fixed_Income/fixedincome_main.html">Fixed income</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Rate_Curves/ratecurves_main.html">Rate Curves</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Risk/risk_main.html">Risk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Others/others_main.html">Others</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>
</div>
        <div class="sidebar-primary-item">
<div id="searchbox"></div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Underlying</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="Underlying">
<h1>Underlying<a class="headerlink" href="#Underlying" title="Permalink to this heading">#</a></h1>
</section>
<section id="NormalAsset">
<h1>NormalAsset<a class="headerlink" href="#NormalAsset" title="Permalink to this heading">#</a></h1>
<section id="_generate_base">
<h2>_generate_base<a class="headerlink" href="#_generate_base" title="Permalink to this heading">#</a></h2>
<p>Returns the underlying following a standard Brownian motion. For each simulation and for each valuation date we have <span class="math notranslate nohighlight">\(S(t)\)</span>. That is to say, for the <span class="math notranslate nohighlight">\(i\)</span>-th simulation and the <span class="math notranslate nohighlight">\(k\)</span>-th valuation date we have:</p>
<div class="math notranslate nohighlight">
\[\textrm{base}[i, j, k] = \Delta Y_{i,k}(t^1_{j-1,k}), \quad j\in\{0, \ldots, J+1\},\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}t^1_{j-1,k}:= \begin{cases} t^1_{j} \qquad \text{ for }j\geq 0 \quad \text{ (independent of } k\text{)}\,,\\
t^0_{k} \qquad \text{ for }j=-1\,,
\end{cases}\end{split}\]</div>
<p>which is consistent with the definition of <code class="docutils literal notranslate"><span class="pre">intervals</span></code> given below. The simulation depends on the starting date as, for instance,</p>
<div class="math notranslate nohighlight">
\[Y_{i,k}(t^1_{0-1,k}) = Y_{i,k}(t^0_{k}) = Y(t_k^0)\,,\]</div>
<p>which is a common value for all simulations for that valuation date.</p>
<section id="Technical-note">
<h3>Technical note<a class="headerlink" href="#Technical-note" title="Permalink to this heading">#</a></h3>
<p>For the sake of educational purposes, let us give a full-detailed description of the actual implementation of this part, with a full vectorization is as follows (no loop needed).Firstly, an adjustment is necessary to account for the expected impact of dividends in the pricing model.</p>
<p>-If <code class="docutils literal notranslate"><span class="pre">forward_measure</span> <span class="pre">=</span> <span class="pre">True</span></code>, then, <span class="math notranslate nohighlight">\(\mu=-d\)</span> and,</p>
<p>-If <code class="docutils literal notranslate"><span class="pre">forward_measure</span> <span class="pre">=</span> <span class="pre">False</span></code>, <span class="math notranslate nohighlight">\(\mu=\text{{self.drift}}-d\)</span>, where the pre-defined drift value, <code class="docutils literal notranslate"><span class="pre">self.drift</span></code>, must also be taken into account.</p>
<p>Let’s assume that <span class="math notranslate nohighlight">\(S_t\)</span> follows a standard geometric Brownian motion, i.e.,</p>
<div class="math notranslate nohighlight">
\[dS_t = \mu S_t dt + \sigma S_t dW_t\,.\]</div>
<p>Let <span class="math notranslate nohighlight">\(Y := \log(S)\)</span>, so <span class="math notranslate nohighlight">\(Y\)</span> follows a normal distribution. Using the Itô rule,</p>
<div class="math notranslate nohighlight">
\[dY_t =  \left(\mu -\frac12 \sigma^2\right) dt + \sigma d W_t \,,\]</div>
<p>which can be easily integrated between <span class="math notranslate nohighlight">\(s\)</span> and <span class="math notranslate nohighlight">\(t\)</span>.</p>
<div class="math notranslate nohighlight">
\[Y_t - Y_s = \left(\mu -\frac12 \sigma^2\right)  (t-s) + \sigma Z\sqrt{t-s} \,,\]</div>
<p>with <span class="math notranslate nohighlight">\(Z\sim\mathcal{N}(0,1).\)</span> Then the <code class="docutils literal notranslate"><span class="pre">base[i,j,k]</span></code> of the Normal Asset <span class="math notranslate nohighlight">\(Y_t\)</span> is given by</p>
<div class="math notranslate nohighlight">
\[\Delta_j{Y}^{i,k} := {Y}^{i,k}(t^1_{j})-{Y}^{i,k}(t^1_{j-1}) = \left(\mu_k -\frac12 \sigma_k^2\right) \textrm{intervals}_{jk} + \sigma_k \cdot \textrm{draws}_{ijk} \cdot \sqrt{\textrm{intervals}_{jk}}\,,\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}\textrm{intervals}[j,k]= \begin{cases}\textrm{intervals}[j,k]=\text{DCC}(t^1_{j-1}, t^1_{j})\text{ for }j&gt;0 \text{ (independent of } k\text{)}\,,\\
\textrm{intervals}[0,k]=\text{DCC}(t^0_{k}, t^1_{0})\text{ for }j=0\,.
\end{cases}\end{split}\]</div>
<p><span class="math notranslate nohighlight">\(\text{DCC}\)</span> represents the day count convention, see [Brigo &amp; Mercurio, 2006], and will depend on the calendar used. For simplicity, we can think of it as <span class="math notranslate nohighlight">\(\text{DCC}(t,t')=t'-t\)</span> as a year fraction. Also,</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">draws[i,j,k]</span></code> is a sample of a random variable for the <span class="math notranslate nohighlight">\(i\)</span>-th simulation and the <span class="math notranslate nohighlight">\(k\)</span>-th valuation date for the <span class="math notranslate nohighlight">\(j\)</span>-th step (simulation date).</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\text{Code}\)</span> - math <span class="math notranslate nohighlight">\((\TeX)\)</span> <strong>translation</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">start_dates</span></code> <span class="math notranslate nohighlight">\(\rightarrow \{t^0_k\}_{k=0}^K\)</span> ,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step_dates</span></code> <span class="math notranslate nohighlight">\(\rightarrow \{t^1_j\}_{j=0}^J\)</span> ,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">draws</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> normal draws as above,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intervals</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> intervals as above,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">forward_measure</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> use of the forward measure as explained above (<code class="docutils literal notranslate"><span class="pre">forward_measure</span> <span class="pre">=</span> <span class="pre">True</span></code> by default).</p></li>
</ul>
</section>
</section>
<section id="generate_paths">
<h2>generate_paths<a class="headerlink" href="#generate_paths" title="Permalink to this heading">#</a></h2>
<p>It returns the simulation paths for the asset price. For the <span class="math notranslate nohighlight">\(i\)</span>-th simulation and the <span class="math notranslate nohighlight">\(k\)</span>-th valuation date if we denote by <code class="docutils literal notranslate"><span class="pre">paths</span></code> the output of this method we have</p>
<div class="math notranslate nohighlight">
\[\textrm{paths}[i,j,k] = Y_{i,k}(t^1_{j-1,k}), \quad j\in\{0, \ldots, J+1\},\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}t^1_{j-1,k}:= \begin{cases} t^1_{j} \qquad \text{ for }j\geq 0 \quad \text{ (independent of } k\text{)}\,,\\
t^0_{k} \qquad \text{ for }j=-1\,,
\end{cases}\end{split}\]</div>
<p>which is consistent with the definition of <code class="docutils literal notranslate"><span class="pre">intervals</span></code> given above. The simulation depends on the starting date as, for instance,</p>
<div class="math notranslate nohighlight">
\[Y_{i,k}^l(t^1_{0-1,k}) = Y_{i,k}^l(t^0_{k}) = Y^l(t_k^0)\,,\]</div>
<p>which is a common value for all simulations for that valuation date, the initial condition that would be obtained using market data. Similarly, parameters can depend on the simulation date.</p>
<p><span class="math notranslate nohighlight">\(\text{Code}\)</span> - math <span class="math notranslate nohighlight">\((\TeX)\)</span> <strong>translation</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">start_dates</span></code> <span class="math notranslate nohighlight">\(\rightarrow \{t^0_k\}_{k=0}^K\)</span> ,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step_dates</span></code> <span class="math notranslate nohighlight">\(\rightarrow \{t^1_j\}_{j=0}^J\)</span> ,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">draws</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> normal draws as above,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intervals</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> intervals as above,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">forward_measure</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> use of the forward measure as explained above (<code class="docutils literal notranslate"><span class="pre">forward_measure</span> <span class="pre">=</span> <span class="pre">True</span></code> by default).</p></li>
</ul>
</section>
</section>
<section id="LogNormalAsset">
<h1>LogNormalAsset<a class="headerlink" href="#LogNormalAsset" title="Permalink to this heading">#</a></h1>
<section id="_generate_prices">
<h2>_generate_prices<a class="headerlink" href="#_generate_prices" title="Permalink to this heading">#</a></h2>
<p>Applies the log of the Normal Asset method. For the conventions and details on the prices see the “Technical note” in the <a class="reference internal" href="#NormalAsset"><span class="std std-ref">NormalAsset section</span></a>.</p>
</section>
<section id="id1">
<h2>generate_paths<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<p>Applies the exponential of the Normal Asset method. For the conventions and details on the paths see the “Technical note” in the <a class="reference internal" href="#NormalAsset"><span class="std std-ref">NormalAsset section</span></a>.</p>
<section id="id2">
<h3>Technical note<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<p>Let us give a full-detailed description of the actual implementation of this part. In this case, as explained above, <span class="math notranslate nohighlight">\(Y_t= \log(S_t)\)</span>, then the path of the LogNormal Asset <span class="math notranslate nohighlight">\(S_t\)</span> is defined as,</p>
<div class="math notranslate nohighlight">
\[S_t = e^{Y_t}= e^{Y_0+ \sum_{i=1}^t \Delta Y_i} = e^{\log(S_0)+ \sum_{i=1}^t \Delta Y_i}= S_0 e^{\sum_{i=1}^t \Delta Y_i}\]</div>
<p>where each <span class="math notranslate nohighlight">\(Y_i\)</span> follows a normal distribution.</p>
</section>
</section>
</section>
<section id="VolModel">
<h1>VolModel<a class="headerlink" href="#VolModel" title="Permalink to this heading">#</a></h1>
<p>Parent class.</p>
<section id="compute_implied_vol">
<h2>compute_implied_vol<a class="headerlink" href="#compute_implied_vol" title="Permalink to this heading">#</a></h2>
<p>For a given set of option prices, it returns the implied volatility according to the specified Black (‘lognormal’) or Bachelier’s formula (‘normal’).</p>
</section>
</section>
<section id="Heston">
<h1>Heston<a class="headerlink" href="#Heston" title="Permalink to this heading">#</a></h1>
<p>A class for simulating the Heston stochastic volatility model using Andersen’s Quadratic Exponential (QE) method.</p>
<p>The Heston model is a widely used model for the dynamics of asset prices and their volatilities. The QE method is an efficient discretization scheme for simulating the Heston model, particularly for cases with high mean reversion and low volatility of volatility.</p>
<p>We will follow the notation used in [Andersen, 2008].</p>
<section id="option_price_functions">
<h2>option_price_functions<a class="headerlink" href="#option_price_functions" title="Permalink to this heading">#</a></h2>
<p>Return European option prices (Call/Put) using the Fast Fourier Transform (FFT) algorithm based on Lewis expression [Lewis, 2000]. We use the library pyfeng. The output for a Call option is</p>
<p><span class="math">\begin{equation*}
\textrm{prices}[i,j] = C(\vec{\theta},K_i,T_j)
\end{equation*}</span> where <span class="math notranslate nohighlight">\(C(\vec{\theta},K_i,T_j)\)</span> is the price of the Call option (the same holds for a put option).</p>
<p><span class="math notranslate nohighlight">\(\text{Code}\)</span> - math <span class="math notranslate nohighlight">\((\TeX)\)</span> <strong>translation</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">params</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\vec{\theta} = (\kappa, \epsilon, \theta, \rho, v_0)\)</span> [Andersen, 2008] parameters of the model,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">strikes</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\{K_i\}_i\)</span> strikes of the options,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">times_exp</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\{T_j\}_j\)</span> times to expiry of the options (in years).</p></li>
</ul>
</section>
<section id="fit_to_options">
<h2>fit_to_options<a class="headerlink" href="#fit_to_options" title="Permalink to this heading">#</a></h2>
<p>Adjust parameters to option prices. The objective function is:</p>
<div class="math notranslate nohighlight">
\[F(\vec{\theta}) = \sum_{i=1}^N (C(\vec{\theta}; K_i, T_i)-\tilde{C}(K_i, T_i))^2\]</div>
<p>where <span class="math notranslate nohighlight">\(\tilde{C}(K_i, T_i)\)</span> is the market price of a call option (same for put) at <span class="math notranslate nohighlight">\(t\)</span>, <span class="math notranslate nohighlight">\(N\)</span> is the number of options used for calibration, <span class="math notranslate nohighlight">\(\{K_i\}_i\)</span> strikes of the options and <span class="math notranslate nohighlight">\(\{T_j\}_j\)</span> times to expiry of the options (in years). <strong>We CAN AlSO divide by the vega due to the reasons explain in page 704 of Vol. III in [Andersen &amp; Piterbarg].</strong></p>
<p><span class="math notranslate nohighlight">\(\text{Code}\)</span> - math <span class="math notranslate nohighlight">\((\TeX)\)</span> <strong>translation</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">date</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> valuation date <span class="math notranslate nohighlight">\(t\)</span>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options_df</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> dataframe defining <span class="math notranslate nohighlight">\(\tilde{C}(K_i, T_i)\)</span>. The columns are the times to expiry (in years) <span class="math notranslate nohighlight">\(\{T_j\}_j\)</span> and the index the strikes <span class="math notranslate nohighlight">\(\{K_i\}_i\)</span>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kind</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\text{call}\)</span> (<span class="math notranslate nohighlight">\(\tilde{C}(K_i, T_i)\)</span>) or <span class="math notranslate nohighlight">\(\text{put}\)</span> (<span class="math notranslate nohighlight">\(\tilde{P}(K_i, T_i)\)</span>),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">recal</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> if <code class="docutils literal notranslate"><span class="pre">recal</span> <span class="pre">=</span> <span class="pre">True</span></code> stochastic optimization is used for obtaining an initial guess for <code class="docutils literal notranslate"><span class="pre">optimize.minimize</span></code>.</p></li>
</ul>
</section>
<section id="generate_paths_vol">
<h2>generate_paths_vol<a class="headerlink" href="#generate_paths_vol" title="Permalink to this heading">#</a></h2>
<p>Returns the variance in the Heston model using Andersen’s Quadratic Exponential (QE) method. For each simulation and for each valuation date we have <span class="math notranslate nohighlight">\(V(t)\)</span> as described in [Andersen, 2008]. That is to say, for the <span class="math notranslate nohighlight">\(i\)</span>-th simulation and the <span class="math notranslate nohighlight">\(k\)</span>-th valuation date we have:</p>
<div class="math notranslate nohighlight">
\[\textrm{vt}[i, j, k, l=0] = \hat{V}_{i,k}(t^1_{j-1,k}), \quad j\in\{0, \ldots, J+1\},\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}t^1_{j-1,k}:= \begin{cases} t^1_{j} \qquad \text{ for }j\geq 0 \quad \text{ (independent of } k\text{)}\,,\\
t^0_{k} \qquad \text{ for }j=-1\,,
\end{cases}\end{split}\]</div>
<p>which is consistent with the definition of <code class="docutils literal notranslate"><span class="pre">intervals</span></code> given below.</p>
<p><span class="math notranslate nohighlight">\(\text{Code}\)</span> - math <span class="math notranslate nohighlight">\((\TeX)\)</span> <strong>translation</strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">start_dates</span></code> <span class="math notranslate nohighlight">\(\rightarrow \{t^0_k\}_{k=0}^K\)</span> ,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">draws</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> draws for the simulation, <span class="math notranslate nohighlight">\(Z_V\)</span> describen in the next section,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intervals</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> intervals for the simulation:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\textrm{intervals}[j,k]= \begin{cases}\textrm{intervals}[j,k]=\text{DCC}(t^1_{j-1}, t^1_{j})\text{ for }j&gt;0 \text{ (independent of } k\text{)}\,,\\
\textrm{intervals}[0,k]=\text{DCC}(t^0_{k}, t^1_{0})\text{ for }j=0\,,
\end{cases}\end{split}\]</div>
</li>
</ul>
<p>where <span class="math notranslate nohighlight">\(\text{DCC}\)</span> represents the day count convention, see Chapter 1 of BM, and will depend on the calendar used. For simplicity, we can think of it as <span class="math notranslate nohighlight">\(\text{DCC}(t,t')=t'-t\)</span> as a year fraction.</p>
</section>
<section id="id3">
<h2>generate_paths<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h2>
<p>It returns the simulation paths for the asset price. Following the notation of [Andersen, 2008], for the <span class="math notranslate nohighlight">\(i\)</span>-th simulation and the <span class="math notranslate nohighlight">\(k\)</span>-th valuation date if we denote by <code class="docutils literal notranslate"><span class="pre">paths</span></code> the output of this method we have</p>
<div class="math notranslate nohighlight">
\[\textrm{paths}[i,j,k,l=0] = \hat{X}_{i,k}(t^1_{j-1,k}), \quad j\in\{0, \ldots, J+1\},\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}t^1_{j-1,k}:= \begin{cases} t^1_{j} \qquad \text{ for }j\geq 0 \quad \text{ (independent of } k\text{)}\,,\\
t^0_{k} \qquad \text{ for }j=-1\,,
\end{cases}\end{split}\]</div>
<p>which is consistent with the definition of <code class="docutils literal notranslate"><span class="pre">intervals</span></code> given above.</p>
<p>Note that in this case, if <strong>CHANGE</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">draws</span> <span class="pre">=</span> <span class="pre">self.generate_draws(corr=corr,</span> <span class="pre">no_obsdates,</span> <span class="pre">no_valuation_dates,</span> <span class="pre">no_sims)</span></code> (inside <code class="docutils literal notranslate"><span class="pre">DeterministicVolDiffusionMC</span></code>)</p>
<p>with <code class="docutils literal notranslate"><span class="pre">corr</span></code> = <span class="math notranslate nohighlight">\(I_2\)</span>, <span class="math notranslate nohighlight">\(2\times2\)</span> identity matrix, we have:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">draws[i,j,k,0]</span></code> is a sample of a random variable (<span class="math notranslate nohighlight">\(Z_V\)</span>) for the i-th simulation and the k-th valuation date for the j-th step (simulation date).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">draws[i,j,k,1]</span></code> is a sample of a random variable (<span class="math notranslate nohighlight">\(Z\)</span>) for the i-th simulation and the k-th valuation date for the j-th step (simulation date).</p></li>
</ul>
</section>
</section>
<section id="MultiAssetHeston(MultiAsset)">
<h1>MultiAssetHeston(MultiAsset)<a class="headerlink" href="#MultiAssetHeston(MultiAsset)" title="Permalink to this heading">#</a></h1>
<section id="id4">
<h2>generate_paths<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h2>
<p>It returns the simulation paths for multiple asset prices using the MultiAssetHeston model. Following the notation of [Andersen, 2008], for the <span class="math notranslate nohighlight">\(i\)</span>-th simulation and the <span class="math notranslate nohighlight">\(k\)</span>-th valuation date if we denote by <code class="docutils literal notranslate"><span class="pre">paths</span></code> the output of this method, we have for the <span class="math notranslate nohighlight">\(l\)</span>-th asset</p>
<div class="math notranslate nohighlight">
\[\textrm{paths}[i,j,k,l] = \hat{X}^l_{i,k}(t^1_{j-1,k}), \quad j\in\{0, \ldots, J+1\},\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}t^1_{j-1,k}:= \begin{cases} t^1_{j} \qquad \text{ for }j\geq 0 \quad \text{ (independent of } k\text{)}\,,\\
t^0_{k} \qquad \text{ for }j=-1\,,
\end{cases}\end{split}\]</div>
<p>which is consistent with the definition of <code class="docutils literal notranslate"><span class="pre">intervals</span></code> given above.</p>
<p>In this case, if we have <code class="docutils literal notranslate"><span class="pre">draws</span> <span class="pre">=</span> <span class="pre">self.generate_draws(corr=corr,</span> <span class="pre">no_obsdates,</span> <span class="pre">no_valuation_dates,</span> <span class="pre">no_sims)</span></code> (inside <code class="docutils literal notranslate"><span class="pre">DeterministicVolDiffusionMC</span></code>), with <code class="docutils literal notranslate"><span class="pre">corr</span></code> being the with <code class="docutils literal notranslate"><span class="pre">corr</span></code> = <span class="math notranslate nohighlight">\(I_{2\times (L+1), 2\times (L+1)}\)</span>, the identity matrix.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">draws[i,j,k,l]</span></code> is a sample of a random variable (<span class="math notranslate nohighlight">\(Z_V^l\)</span>) for the <span class="math notranslate nohighlight">\(i\)</span>-th simulation, the <span class="math notranslate nohighlight">\(k\)</span>-th valuation date, and the <span class="math notranslate nohighlight">\(l\)</span>-th asset for the <span class="math notranslate nohighlight">\(j\)</span>-th step (simulation date).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">draws[...,</span> <span class="pre">self.no_assets:]</span></code> corresponds to the vector of i.i.d. standard normal variables (<span class="math notranslate nohighlight">\(Z\)</span>) used in (A.24) of Mokone. This must be properly transformed so that we can use Andersen’s approach (<code class="docutils literal notranslate"><span class="pre">Heston.generate_paths</span></code> here) for a single asset. In particular, from the aforementioned (A.24) and (9.85) of Andersen and Piterbarg, we have:</p>
<div class="math notranslate nohighlight">
\[Z^{\text{Andersen}} = L^* D Z,\qquad D=\text{diag}\left(\frac1{\sqrt{1-\rho_0^2}},\ldots,\frac1{\sqrt{1-\rho_L^2}}\right).\]</div>
</li>
</ul>
<p>Here, <span class="math notranslate nohighlight">\(l\)</span> ranges from <span class="math notranslate nohighlight">\(0\)</span> to <span class="math notranslate nohighlight">\(L\)</span>.</p>
</section>
</section>
<section id="SABR">
<h1>SABR<a class="headerlink" href="#SABR" title="Permalink to this heading">#</a></h1>
<p>A class for simulating the SABR stochastic volatility model using the stochastic Alpha Beta Rho stochastic volatility (SABR-SV) model, which is widely used in the fi- nancial industry for the pricing of fixed income instruments. We will follow the notation used in [Chen et al., 2011].</p>
<section id="id5">
<h2>generate_paths_vol<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h2>
<p>Returns the variance in the SABR model following a standard geometric Brownian motion, p.18 of Chen et al. For each simulation and for each valuation date we have <span class="math notranslate nohighlight">\(\sigma(t)\)</span> as described in [Chen et al., 2011]. That is to say, for the <span class="math notranslate nohighlight">\(i\)</span>-th simulation and the <span class="math notranslate nohighlight">\(k\)</span>-th valuation date we have:</p>
<div class="math notranslate nohighlight">
\[\textrm{paths}[i, j, k] = \hat{\sigma}_{i,k}(t^1_{j-1,k}), \quad j\in\{0, \ldots, J+1\},\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}t^1_{j-1,k}:= \begin{cases} t^1_{j} \qquad \text{ for }j\geq 0 \quad \text{ (independent of } k\text{)}\,,\\
t^0_{k} \qquad \text{ for }j=-1\,,
\end{cases}\end{split}\]</div>
<p>which is consistent with the definition of <code class="docutils literal notranslate"><span class="pre">intervals</span></code> given below. The simulation depends on the starting date as, for instance,</p>
<div class="math notranslate nohighlight">
\[\hat{\sigma}_{i,k}(t^1_{0-1,k}) = \hat{\sigma}_{i,k}(t^0_{k}) = \sigma(t_k^0)\,,\]</div>
<p>which is a common value for all simulations for that valuation date. For observable parameters, the initial condition would be obtained using market data, although here this parameter can be subject to calibration. Similarly, parameters can depend on the simulation date.</p>
<section id="id6">
<h3>Technical note<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h3>
<p>For the sake of educational purposes, let us give a full-detailed description of the actual implementation of this part, with a full vectorization is as follows (no loop needed). As <span class="math notranslate nohighlight">\(\sigma\)</span> follows a standard geometric Brownian motion with zero drift, i.e.,</p>
<div class="math notranslate nohighlight">
\[d\sigma_t = \alpha \sigma_t dW_t\,,\]</div>
<p>let <span class="math notranslate nohighlight">\(Y := \log(\sigma)\)</span>, using the Itô rule,</p>
<div class="math notranslate nohighlight">
\[dY_t = -\frac12 \alpha^2 dt + \alpha d W_t \,,\]</div>
<p>which can be easily integrated between <span class="math notranslate nohighlight">\(s\)</span> and <span class="math notranslate nohighlight">\(t\)</span>.</p>
<div class="math notranslate nohighlight">
\[Y_t - Y_s = -\frac12 \alpha^2 (t-s) + \alpha Z\sqrt{t-s} \,,\]</div>
<p>with <span class="math notranslate nohighlight">\(Z\sim\mathcal{N}(0,1).\)</span> Then <code class="docutils literal notranslate"><span class="pre">base[i,j,k]</span></code> is given by</p>
<div class="math notranslate nohighlight">
\[\Delta_j\hat{Y}^{i,k} := \hat{Y}^{i,k}(t^1_{j})-\hat{Y}^{i,k}(t^1_{j-1}) = -\frac12 \alpha_k^2 \textrm{intervals}_{jk} + \alpha_k \cdot \textrm{draws}_{ijk} \cdot \sqrt{\textrm{intervals}_{jk}}\,,\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}\textrm{intervals}[j,k]= \begin{cases}\textrm{intervals}[j,k]=\text{DCC}(t^1_{j-1}, t^1_{j})\text{ for }j&gt;0 \text{ (independent of } k\text{)}\,,\\
\textrm{intervals}[0,k]=\text{DCC}(t^0_{k}, t^1_{0})\text{ for }j=0\,.
\end{cases}\end{split}\]</div>
<p><span class="math notranslate nohighlight">\(\text{DCC}\)</span> represents the day count convention, see [Brigo &amp; Mercurio, 2006], and will depend on the calendar used. For simplicity, we can think of it as <span class="math notranslate nohighlight">\(\text{DCC}(t,t')=t'-t\)</span> as a year fraction. Also,</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">draws[i,j,k]</span></code> is a sample of a random variable for the <span class="math notranslate nohighlight">\(i\)</span>-th simulation and the <span class="math notranslate nohighlight">\(k\)</span>-th valuation date for the <span class="math notranslate nohighlight">\(j\)</span>-th step (simulation date).</p></li>
</ul>
<p>Thus, a telescopic cancellation gives, by definition using <code class="docutils literal notranslate"><span class="pre">np.add.accumulate</span></code>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\textrm{paths}[i,j,k]= \begin{cases}\textrm{paths}[i,j,k]=\sum_{j'=0}^{j-1}\Delta_{j'}\hat{Y}^{i,k} = \hat{Y}^{i,k}(t^1_{j-1})-\hat{Y}^{i,k}(t^1_0) = \hat{Y}^{i,k}(t^1_{j-1})-\log(\sigma_0^k)
&amp;\text{ for }j&gt;0 \,,\\
\textrm{paths}[i,0,k]=0&amp;\text{ for }j=0\,.
\end{cases}\end{split}\]</div>
<p>Finally, renaming <code class="docutils literal notranslate"><span class="pre">paths</span></code>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\hat{\sigma}_{i,k}(t^1_{j-1})=\textrm{paths}[i,j,k]= \begin{cases}\textrm{paths}[i,j,k]=\sigma_0^k\cdot \exp\left(\hat{Y}^{i,k}(t^1_{j-1})-\log(\sigma_0^k)\right) = \exp\left(\hat{Y}^{i,k}(t^1_{j-1})\right)
&amp;\text{ for }j&gt;0 \,,\\
\textrm{paths}[i,0,k]=\sigma_0^k&amp;\text{ for }j=0\,.
\end{cases}\end{split}\]</div>
<p><span class="math notranslate nohighlight">\(\text{Code}\)</span> - math <span class="math notranslate nohighlight">\((\TeX)\)</span> <strong>translation</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">start_dates</span></code> <span class="math notranslate nohighlight">\(\rightarrow \{t^0_k\}_{k=0}^K\)</span> ,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">draws</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> normal draws as above,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intervals</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> intervals as above.</p></li>
</ul>
</section>
</section>
<section id="id7">
<h2>generate_paths<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h2>
<p>It returns the simulation paths for the asset price. Following the notation of [Chen et al., 2011], for the <span class="math notranslate nohighlight">\(i\)</span>-th simulation and the <span class="math notranslate nohighlight">\(k\)</span>-th valuation date if we denote by <code class="docutils literal notranslate"><span class="pre">paths</span></code> the output of this method we have</p>
<div class="math notranslate nohighlight">
\[\textrm{paths}[i,j,k,l=0] = \hat{S}_{i,k}(t^1_{j-1,k}), \quad j\in\{0, \ldots, J+1\},\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}t^1_{j-1,k}:= \begin{cases} t^1_{j} \qquad \text{ for }j\geq 0 \quad \text{ (independent of } k\text{)}\,,\\
t^0_{k} \qquad \text{ for }j=-1\,,
\end{cases}\end{split}\]</div>
<p>which is consistent with the definition of <code class="docutils literal notranslate"><span class="pre">intervals</span></code> given above. The simulation depends on the starting date as, for instance,</p>
<div class="math notranslate nohighlight">
\[\hat{S}_{i,k}(t^1_{0-1,k}) = \hat{S}_{i,k}(t^0_{k}) = S(t_k^0)\,,\]</div>
<p>which is a common value for all simulations for that valuation date, the initial condition that would be obtained using market data. Similarly, parameters can depend on the simulation date.</p>
<p>In this case, we have:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">draws[i,j,k,0]</span></code> is a sample of a normal random variable (<span class="math notranslate nohighlight">\(W_{2,1}\)</span>, p.18) for the <span class="math notranslate nohighlight">\(i\)</span>-th simulation and the <span class="math notranslate nohighlight">\(k\)</span>-th valuation date for the <span class="math notranslate nohighlight">\(j\)</span>-th step (simulation date).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">draws[i,j,k,1]</span></code> is a sample of a normal random variable (<span class="math notranslate nohighlight">\(W_{1}=N^{-1}(U_1)\)</span>, p.19) for the <span class="math notranslate nohighlight">\(i\)</span>-th simulation and the <span class="math notranslate nohighlight">\(k\)</span>-th valuation date for the <span class="math notranslate nohighlight">\(j\)</span>-th step (simulation date).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">draws[i,j,k,2]</span></code> is a sample of a normal random variable (<span class="math notranslate nohighlight">\(Z\)</span> of (3.9)) for the <span class="math notranslate nohighlight">\(i\)</span>-th simulation and the <span class="math notranslate nohighlight">\(k\)</span>-th valuation date for the <span class="math notranslate nohighlight">\(j\)</span>-th step (simulation date).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">draws[i,j,k,3]</span></code> is a sample of a <em>uniform</em> random variable (<span class="math notranslate nohighlight">\(U\)</span> of p.13) for the <span class="math notranslate nohighlight">\(i\)</span>-th simulation and the <span class="math notranslate nohighlight">\(k\)</span>-th valuation date for the <span class="math notranslate nohighlight">\(j\)</span>-th step (simulation date).</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\text{Code}\)</span> - math <span class="math notranslate nohighlight">\((\TeX)\)</span> <strong>translation</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">start_dates</span></code> <span class="math notranslate nohighlight">\(\rightarrow \{t^0_k\}_{k=0}^K\)</span> ,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step_dates</span></code> <span class="math notranslate nohighlight">\(\rightarrow \{t^1_j\}_{j=0}^J\)</span> ,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">draws</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> normal draws as above,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intervals</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> intervals as above.</p></li>
</ul>
</section>
</section>
<section id="References">
<h1>References<a class="headerlink" href="#References" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>[Andersen, 2008] Andersen, L. (2008). Simple and efficient simulation of the Heston stochastic volatility model. Journal of Computational Finance, 11(3), 1-42.</p></li>
<li><p>[Brigo &amp; Mercurio, 2006] Brigo, D., &amp; Mercurio, F. (2006). Interest Rate Models: Theory and Practice(Chapter 1). Springer.</p></li>
<li><p>[Chen et al., 2011] Chen, B., Grzelak, L. A., &amp; Oosterlee, C. W. (2011). Calibration and Monte Carlo pricing of the SABR-Hull-White model for long-maturity equity derivatives. The Journal of Computational Finance (79–113) Volume, 15.</p></li>
<li><p>[Andersen &amp; Piterbarg, 2010] Andersen, L. and Piterbarg, V., (2010). Interest Rate Modeling.</p></li>
</ul>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Underlying</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#NormalAsset">NormalAsset</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#_generate_base">_generate_base</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Technical-note">Technical note</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate_paths">generate_paths</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#LogNormalAsset">LogNormalAsset</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#_generate_prices">_generate_prices</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">generate_paths</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Technical note</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#VolModel">VolModel</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compute_implied_vol">compute_implied_vol</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#Heston">Heston</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#option_price_functions">option_price_functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fit_to_options">fit_to_options</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate_paths_vol">generate_paths_vol</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">generate_paths</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#MultiAssetHeston(MultiAsset)">MultiAssetHeston(MultiAsset)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">generate_paths</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#SABR">SABR</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">generate_paths_vol</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Technical note</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">generate_paths</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#References">References</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2023, AFS.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.0.1.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>